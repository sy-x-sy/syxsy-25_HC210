<!DOCTYPE html>
<html lang="ko">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <link rel="stylesheet" href="vacc_globals.css" />
  <link rel="stylesheet" href="vacc_styleguide.css" />
  <link rel="stylesheet" href="vacc_style.css" />
  <title>ì˜ˆë°©ì ‘ì¢… ê¸°ë¡</title>
  <style>
    .delete-button {
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      color: red;
      margin-left: 8px;
    }

    .add-record-button {
      margin: 30px auto;
      display: block;
      padding: 10px 20px;
      background-color: #f8de9a;
      color: black;
      border: none;
      border-radius: 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <main class="vaccination-record">
    <header>
      <a href="../_3_home/home.html" class="back-button" aria-label="ë’¤ë¡œ ê°€ê¸°">
        <img src="vacc/back.svg" alt="ë’¤ë¡œ ê°€ê¸° ì•„ì´ì½˜" />
      </a>
      <h1>ì˜ˆë°©ì ‘ì¢… ê¸°ë¡</h1>
    </header>

    <section class="monthly-vaccinations">
      <h2>ì´ë²ˆë‹¬ ì˜ˆë°©ì ‘ì¢… ëª©ë¡</h2>
      <ul id="this-month-list">
        <!-- JSë¡œ ìë™ ì‚½ì…ë¨ -->
      </ul>
    </section>

    <section class="vaccination-timeline">
      <h2 class="visually-hidden">ì›”ë³„ ì˜ˆë°©ì ‘ì¢… ë‚´ì—­</h2>
      <div id="vaccination-list"></div>
    </section>

    <div style="text-align: center">
      <button onclick="location.href='vacc_input.html'" class="add-record-button">+ ê¸°ë¡ ì¶”ê°€í•˜ê¸°</button>
    </div>
  </main>

  <script>
    const records = JSON.parse(localStorage.getItem("vaccinations") || "[]");

    const thisMonthList = document.getElementById("this-month-list");
    const currentMonth = new Date().getMonth() + 1;
    const currentMonthVaccines = records.filter(r => r.month === currentMonth);
    currentMonthVaccines.forEach(r => {
      const li = document.createElement("li");
      li.textContent = r.name;
      thisMonthList.appendChild(li);
    });

    const iconMap = {
      "ê´‘ê²¬ë³‘": "vaccine.svg",
      "ì¢…í•©ë°±ì‹ ": "pet.svg",
      "ì¸í”Œë£¨ì—”ì": "medicine.svg",
      "ì¼„ë„¬ì½”í”„": "medicine.svg"
    };

    const grouped = {};
    records.forEach((r) => {
      if (!grouped[r.month]) grouped[r.month] = [];
      grouped[r.month].push(r);
    });

    const container = document.getElementById("vaccination-list");
    const monthNames = ["", "1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”", "6ì›”", "7ì›”", "8ì›”", "9ì›”", "10ì›”", "11ì›”", "12ì›”"];

    Object.keys(grouped)
      .sort((a, b) => Number(a) - Number(b))
      .forEach((month) => {
        const section = document.createElement("article");
        section.className = "month";
        section.innerHTML = `<h3>${monthNames[month]}</h3><ul></ul>`;

        const ul = section.querySelector("ul");
        grouped[month].forEach((r, i) => {
          const index = records.findIndex(item =>
            item.name === r.name &&
            item.date === r.date &&
            item.hospital === r.hospital &&
            item.price === r.price
          );

          const icon = iconMap[r.name] || "medical.svg";

          ul.innerHTML += `
              <li class="vaccination-item">
                <img src="vacc/${icon}" alt="" class="icon" />
                <div class="details">
                  <h4>${r.name}</h4>
                  <time>${r.date}</time>
                </div>
                <div class="hospital">${r.hospital}</div>
                <div class="cost">${r.price}ì›</div>
                <button class="delete-button" data-index="${index}">ğŸ—‘</button>
              </li>
            `;
        });

        container.appendChild(section);
      });

    // ì‚­ì œ ì´ë²¤íŠ¸ ì²˜ë¦¬
    document.addEventListener("click", (e) => {
  if (e.target.classList.contains("delete-button")) {
    const index = e.target.getAttribute("data-index");
    const records = JSON.parse(localStorage.getItem("vaccinations") || "[]");
    records.splice(index, 1);
    localStorage.setItem("vaccinations", JSON.stringify(records));
    location.reload();
  }
});
  </script>
</body>

</html>