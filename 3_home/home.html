<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>ë°˜ë ¤ë™ë¬¼ ê±´ê°• ê´€ë¦¬ ì•±</title>
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="styleguide.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      /* ë„ë„› ì°¨íŠ¸ ìœ„ì¹˜ ë° í¬ê¸° */
      .chart-wrapper {
        position: absolute;
        top: 10px;
        left: 45px;
        width: 130px;
        height: 130px;
      }

      canvas#fatigueChart {
        width: 130px !important;
        height: 130px !important;
      }

      .status-info-group {
        position: absolute;
        left: 190px; /* ë„ë„› ì°¨íŠ¸ ì˜¤ë¥¸ìª½ì— ìœ„ì¹˜ */
        top: 50%; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ ê¸°ì¤€ */
        transform: translateY(-50%); /* ì •í™•í•œ ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
        text-align: center; /* ë‚´ë¶€ í…ìŠ¤íŠ¸ë“¤ ì¤‘ì•™ ì •ë ¬ */
      }

      .status-card .status-title {
        margin: 0;
        font-size: 18px;
        color: #333; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì¡°ì • */
        white-space: nowrap;
      }

      .fatigue-state-chip {
        display: inline-block; /* ë‚´ìš©ë¬¼ í¬ê¸°ì— ë§ê²Œ */
        margin-top: 15px; /* ì œëª©ê³¼ì˜ ê°„ê²© */
        padding: 10px 25px; /* ë‚´ë¶€ ì—¬ë°± ì¡°ì • */
        border-radius: 30px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
        font-size: 18px; /* ê¸€ê¼´ í¬ê¸° í‚¤ì›€ */
        font-weight: 700;
        color: #052224;
        background-color: #FFF; /* ê¸°ë³¸ ë°°ê²½ìƒ‰ */
        min-width: 100px; /* ìµœì†Œ ë„ˆë¹„ ì§€ì • */
      }
    </style>
</head>
  <body>
    <main class="element-a-home">
      <div class="app-container">
        <header class="app-header">
          <div class="user-greeting">
            <h1 class="user-name">SoH</h1>
            <p class="greeting-message">ì˜¤ëŠ˜ë„ ë°˜ë ¤ë™ë¬¼ê³¼ ê±´ê°•í•œ í•˜ë£¨ ë˜ì„¸ìš”!</p>
          </div>
          <a class="notification-button" href="../4_sign/sign.html" aria-label="ì•Œë¦¼">
            <img class="icon-notification" src="Vector1.svg" alt="ì•Œë¦¼ ì•„ì´ì½˜" />
          </a>
        </header>

        <section class="pet-profile">
          <a href="/syxsy-25_H210/10_profile/profile.html" class="pet-card">
            <img class="pet-avatar" src="free-icon-dog-119576461.svg" alt="ë°˜ë ¤ë™ë¬¼ ì•„ë°”íƒ€" />
            <div class="pet-info">
              <h2 class="pet-name">ë°˜ë ¤ê²¬</h2>
              <p class="pet-details">ì •ë³´ ì—†ìŒ</p>
            </div>
          </a>
        </section>

        <section class="health-status">
  <div class="status-card">
    <div class="chart-wrapper">
      <canvas id="fatigueChart"></canvas>
    </div>

    <div class="status-info-group">
      <h3 class="status-title">í˜„ì¬ ê·¼ìœ¡ í”¼ë¡œë„</h3>
      <div id="fatigueStateChip" class="fatigue-state-chip">ì—°ê²° ì¤‘...</div>
    </div>
  </div>
</section>

        <nav class="feature-navigation">
          <div class="feature-row">
            <a href="../5_muscle/muscle.html" class="feature-item">
              <div class="feature-icon-wrapper">
                <img class="feature-icon" src="Vector.svg" alt="ê·¼ìœ¡ í”¼ë¡œë„ ì•„ì´ì½˜" />
              </div>
              <span class="feature-label">ê·¼ìœ¡ í”¼ë¡œë„</span>
            </a>
            <a href="../6_heart/heart.html" class="feature-item">
              <div class="feature-icon-wrapper">
                <img class="feature-icon" src="Vector2.svg" alt="ì‹¬ë°•ìˆ˜ ì•„ì´ì½˜" />
              </div>
              <span class="feature-label">ì‹¬ë°•ìˆ˜</span>
            </a>
            <a href="../13_report/weekly.html" class="feature-item">
              <div class="feature-icon-wrapper">
                <img class="feature-icon" src="Vector3.svg" alt="ë¦¬í¬íŠ¸ ì•„ì´ì½˜" />
              </div>
              <span class="feature-label">ë¦¬í¬íŠ¸</span>
            </a>
          </div>

          <div class="feature-row">
            <a href="../10_1_set/set.html" class="feature-item">
              <div class="feature-icon-wrapper">
                <img class="feature-icon" src="Vector4.svg" alt="ë„ì›€ë§ ì•„ì´ì½˜" />
              </div>
              <span class="feature-label">ì„¤ì •</span>
            </a>
            <a href="../14_vaccine/vacc.html" class="feature-item">
              <div class="feature-icon-wrapper vaccination">
                <img class="feature-icon" src="Vector5.svg" alt="ì˜ˆë°©ì ‘ì¢… ì•„ì´ì½˜" />
              </div>
              <span class="feature-label">ì˜ˆë°©ì ‘ì¢…</span>
            </a>
            <a href="../15_emergency/emergency.html" class="feature-item">
              <div class="feature-icon-wrapper">
                <img class="feature-icon" src="Vector6.svg" alt="ì‘ê¸‰ì²˜ì¹˜ ì•„ì´ì½˜" />
              </div>
              <span class="feature-label">ì‘ê¸‰ì²˜ì¹˜</span>
            </a>
          </div>
        </nav>
      </div>
    </main>

    <script>
      // ğŸ¾ í”„ë¡œí•„ ë°ì´í„° ë°˜ì˜
      window.addEventListener("DOMContentLoaded", function () {
        const dogName = localStorage.getItem("dog_id") || "ë°˜ë ¤ê²¬";
        const dogSize = localStorage.getItem("dog_size") || "í¬ê¸° ì—†ìŒ";
        const dogGender = localStorage.getItem("dog_gender") || "ì„±ë³„ ì—†ìŒ";
        const dogPhoto = localStorage.getItem("dog_photo") || "free-icon-dog-119576461.svg";
        document.querySelector(".pet-name").textContent = dogName;
        document.querySelector(".pet-details").textContent = `${dogSize} â€¢ ${dogGender}`;
        document.querySelector(".pet-avatar").src = dogPhoto;
      });

      // ğŸ“Š Chart.js ë„ë„› ì´ˆê¸°í™” (ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€)
      const ctx = document.getElementById("fatigueChart").getContext("2d");
      const fatigueChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          datasets: [
            {
              data: [0, 100],
              backgroundColor: ["#7ACB77", "#E0E0E0"],
              borderWidth: 0,
            },
          ],
        },
        options: {
          cutout: "75%",
          maintainAspectRatio: false,
          animation: {
            duration: 1200, // 1.2ì´ˆ ë™ì•ˆ ì• ë‹ˆë©”ì´ì…˜
            easing: "easeInOutQuad", // ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ê³¡ì„ 
          },
          plugins: {
            legend: { display: false },
            tooltip: { enabled: false },
          },
        },
      });

      // ğŸ”„ ì‹¤ì‹œê°„ ë°ì´í„° ë°˜ì˜
      const ENDPOINT = "http://172.20.10.2/data";
      // const fatigueValueEl = document.getElementById("fatigueValue"); // í¼ì„¼íŠ¸ ê°’ì€ ì´ì œ í‘œì‹œí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì œê±°
      const fatigueStateChip = document.getElementById("fatigueStateChip"); // âœ… ìƒˆë¡œìš´ ìƒíƒœ ì¹© ìš”ì†Œ

      // âœ… getState í•¨ìˆ˜ëŠ” ìƒíƒœ í…ìŠ¤íŠ¸ì™€ ë°°ê²½ìƒ‰ì„ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì • (ì²« ë²ˆì§¸ ì´ë¯¸ì§€ì˜ ìƒ‰ìƒì„ ì°¸ì¡°)
      function getState(f) {
        if (f >= 70) return { text: "ê²½ê³ ", bgColor: "#FEE2E2", textColor: "#D32F2F" }; // ê²½ê³  (ë¹¨ê°„ ë°°ê²½, ë¹¨ê°„ ê¸€ì”¨)
        if (f >= 50) return { text: "ì£¼ì˜", bgColor: "#FFF3E0", textColor: "#F57C00" }; // ì£¼ì˜ (ì£¼í™© ë°°ê²½, ì£¼í™© ê¸€ì”¨)
        return { text: "ì–‘í˜¸", bgColor: "#E8F5E9", textColor: "#388E3C" }; // ì–‘í˜¸ (ë…¹ìƒ‰ ë°°ê²½, ë…¹ìƒ‰ ê¸€ì”¨)
      }

      async function updateFatigue() {
        try {
          const r = await fetch(ENDPOINT, { cache: "no-store" });
          const json = await r.json();
          const fatigue = parseFloat(json.fatigue);

          if (!isNaN(fatigue)) {
            const s = getState(fatigue);
            // ğŸ”¥ ì• ë‹ˆë©”ì´ì…˜ ê°±ì‹  (ì°¨íŠ¸ ìƒ‰ìƒë§Œ ë³€ê²½)
            fatigueChart.data.datasets[0].data = [fatigue, 100 - fatigue];
            fatigueChart.data.datasets[0].backgroundColor = [s.textColor, "#E0E0E0"]; // ë„ë„› ìƒ‰ìƒë„ ìƒíƒœ í…ìŠ¤íŠ¸ ìƒ‰ìƒê³¼ ë§ì¶¤
            fatigueChart.update("active");

            // âœ… ìƒíƒœ ì¹©ì— í…ìŠ¤íŠ¸ ë° ìŠ¤íƒ€ì¼ ì ìš©
            fatigueStateChip.textContent = s.text;
            fatigueStateChip.style.backgroundColor = s.bgColor;
            fatigueStateChip.style.color = s.textColor;
          } else {
            // fatigueValueEl.textContent = "--%"; // í¼ì„¼íŠ¸ ê°’ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            fatigueStateChip.textContent = "ì—°ê²° ëŠê¹€";
            fatigueStateChip.style.backgroundColor = "#E0E0E0";
            fatigueStateChip.style.color = "#888";
          }
        } catch (e) {
          // fatigueValueEl.textContent = "--%"; // í¼ì„¼íŠ¸ ê°’ í‘œì‹œí•˜ì§€ ì•ŠìŒ
          fatigueStateChip.textContent = "ì—°ê²° ëŠê¹€";
          fatigueStateChip.style.backgroundColor = "#E0E0E0";
          fatigueStateChip.style.color = "#888";
        }
      }

      // 2ì´ˆë§ˆë‹¤ ë¶€ë“œëŸ½ê²Œ ê°±ì‹ 
      setInterval(updateFatigue, 2000);
      updateFatigue();
    </script>
  </body>
</html>